<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>RPP Generator</title>
  <script>
    let tpTerpilih = "";

    async function cariTP() {
      const mapel = document.getElementById('mataPelajaran').value;
      const kelas = document.getElementById('kelas').value;
      const btn = document.getElementById('btn-tp');
      const listArea = document.getElementById('list-tp');

      if (!mapel) return alert("Ketik dulu Mata Pelajarannya ya, Pak.");

      btn.innerText = "Sedang Mencari TP...";
      btn.disabled = true;

      try {
        const response = await fetch('/api/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ mode: "CARI_TP", mataPelajaran: mapel, kelas: kelas })
        });

        const data = await response.json();

        if (data.error) {
          alert("Error: " + data.error);
          return;
        }

        listArea.innerHTML = "";
        data.pilihanTP.forEach((tp) => {
          listArea.innerHTML += `
            <label class="flex items-start gap-3 p-4 border-2 border-slate-100 rounded-2xl hover:bg-blue-50 cursor-pointer transition-all">
              <input type="radio" name="pilih_tp" value="${tp}" class="mt-1" onclick="tpTerpilih = this.value">
              <span class="text-sm font-semibold text-slate-700">${tp}</span>
            </label>`;
        });

        document.getElementById('area-pilihan-tp').classList.remove('hidden');
        document.getElementById('btn-gen').classList.remove('hidden');
      } catch (e) {
        console.error(e);
        alert("Gagal koneksi ke server.");
      } finally {
        btn.innerText = "Cari Tujuan";
        btn.disabled = false;
      }
    }

    async function generateRPP() {
      if (!tpTerpilih) return alert("Pilih dulu TP-nya, Pak.");
      const mapel = document.getElementById('mataPelajaran').value;
      const kelas = document.getElementById('kelas').value;

      const btn = document.getElementById('btn-gen');
      btn.innerText = "Sedang Membuat RPP...";
      btn.disabled = true;

      try {
        const response = await fetch('/api/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            mode: "BUAT_RPP",
            mataPelajaran: mapel,
            kelas: kelas,
            tujuanPembelajaran: tpTerpilih
          })
        });

        const data = await response.json();
        if (data.error) {
          alert("Error: " + data.error);
          return;
        }

        document.getElementById('hasil-rpp').innerText = JSON.stringify(data, null, 2);
      } catch (e) {
        console.error(e);
        alert("Gagal koneksi ke server.");
      } finally {
        btn.innerText = "Generate RPP";
        btn.disabled = false;
      }
    }
  </script>
</head>
<body>
  <h1>ðŸ“˜ RPP Generator</h1>
  <img src="wawan.png" alt="Foto Wawan" width="150" style="border-radius: 10px; margin-bottom: 20px;">
  
  <div>
    <label>Mata Pelajaran: <input id="mataPelajaran" type="text"></label><br>
    <label>Kelas: <input id="kelas" type="text"></label><br>
    <button id="btn-tp" onclick="cariTP()">Cari Tujuan</button>
  </div>

  <div id="area-pilihan-tp" class="hidden">
    <h3>Pilih Tujuan Pembelajaran:</h3>
    <div id="list-tp"></div>
  </div>

  <button id="btn-gen" class="hidden" onclick="generateRPP()">Generate RPP</button>

  <pre id="hasil-rpp" style="background:#f0f0f0; padding:10px; margin-top:20px;"></pre>
</body>
</html>
